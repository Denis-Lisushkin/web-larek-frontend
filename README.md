# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта

- src/components/ — папка с JS компонентами

- src/components/base/ — папка с базовым кодом

  
Важные файлы:

- src/pages/index.html — HTML-файл главной страницы

- src/types/index.ts — файл с типами

- src/index.ts — точка входа приложения

- src/styles/styles.scss — корневой файл стилей

- src/utils/constants.ts — файл с константами

- src/utils/utils.ts — файл с утилитами

  

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

  

```

npm install

npm run start

```

  

или

  

```

yarn

yarn start

```

## Сборка

  

```

npm run build

```

  

или

  

```

yarn build

```

## Интерфейсы проекта

### IProduct
Модель данных одиного товара.
```
  id: string;                 // Уникальный идентификатор товара
  description?: string;       // Описание товара (необязательное поле)
  image: string;              // Ссылка на изображение товара
  title: string;              // Название товара
  category: string;           // Категория, к которой относится товар
  price: number | null;       // Цена товара (может быть null, если не указана)
  selected: boolean;          // Флаг: выбран ли товар (например, добавлен в корзину)
```
---
### ICart 
Модель корзины покупателя.
```
  items: IProduct[];          // Список товаров в корзине
  total: number;              // Общая стоимость товаров
```
---
### IOrder
Модель данных заказа.
```
  payment: string;            // Способ оплаты
  email: string;              // Email пользователя
  phone: string;              // Телефон пользователя
  address: string;            // Адрес доставки
  total: number;              // Общая сумма заказа
  items: string[];            // Массив ID товаров в заказе
```
---
### IOrderResult
модель данных оформленного заказа.
```
  id: string;                 // Уникальный идентификатор заказа
  total: number;              // Итоговая сумма заказа
```
---
### IAppData
Главный интерфейс приложения: содержит данные и управляющие методы.

#### Свойства:
```
  products: IProduct[];       // Список всех доступных товаров
  cart: ICart;                // Текущая корзина
  order: IOrder;              // Текущий заказ
```
#### методы:
```
  setProducts(products: IProduct[]): void;                     // Установить список товаров
  addProductToCart(item: IProduct): void;                      // Добавить товар в корзину
  removeProductFromCart(item: IProduct): void;                 // Удалить товар из корзины
  getCartTotal(): number;                                      // Получить общую стоимость корзины
  getCartCounter(): number;                                    // Получить количество товаров в корзине
  setOrderField(field: keyof IOrderForm, value: string): void; // Установить поле в форме заказа
  setContactField(field: keyof IOrderForm, value: string): void; // Установить поле в форме кантактов
  setOrderProductsList(): void;                                // Заполнить список товаров для заказа
  validateForm(formName: 'order' | 'contacts'): boolean;       // Проверить валидность формы
  resetCart(): void;                                           // Очистить корзину
  resetOrder(): void;                                          // Очистить форму заказа
  resetSelectedProducts(): void;                               // Сбросить флаг выбора у всех товаров
  resetOrderAndCart(): void;                                   // Полностью сбросить корзину и заказ
``` 
---
### ILarekAPI 
Интерфейс для класса работы с API
```
getProductsList: () => Promise<IProduct[]>;              // Получить список всех товаров с сервера
orderProducts: (order: IOrder) => Promise<IOrderResult>; // Отправить заказ на сервер
```
---
### IPage 
Интерфейс главной страницы
```
counter: number;              // Количество товаров в корзине
catalog: HTMLElement[];       // DOM-элементы карточек товаров
scrollLocked: boolean;        // Заблокирована ли прокрутка (например, при открытом модальном окне)
```
---
### ICartView 
Отображение корзины
```
items: HTMLElement[];       // DOM-элементы товаров в корзине
title: string;              // Заголовок
total: number;              // Общая сумма товаров в корзине
button: HTMLElement;        // Кнопка оформления заказа
```
---
### IProductInCart extends IProduct 
Интерфейс карточки товара в корзине
```
index: number;                    // Индекс позиции в списке корзины
title: string;                    // Название товара
price: number;                    // Цена товара (гарантированно не null)
buttonDelete: HTMLButtonElement;  // Кнопка удаления товара из корзины
```
---
### IOrderForm
Отоброжение формы заказа.
```
  payment: string;            // Способ оплаты
  address: string;            // Адрес доставки
  email: string;              // Email пользователя
  phone: string;              // Телефон пользователя
```
---
### ISuccessView
Отображение  окна успешного оформления заказа
```
total: number;                // Итоговая сумма заказа
```
---
### IModalData
Интерфейс модального окна
```
content: HTMLElement;         // Контент, который нужно отобразить в модальном окне
```
---
### IFormState 
Интерфейс родительского класса форм
```
valid: boolean;               // Флаг валидности формы
errors: string[];             // Список ошибок при валидации
```
---

## Архитектура
Приложение построено по архитектурному паттерну **MVP (Model-View-Presenter)**.

В качестве механизма взаимодействия между компонентами используется брокер событий, что позволяет добиться слабой связанности и повысить масштабируемость кода.

Бизнес-логика вынесена в презентеры, модель хранит и управляет данными, а представление отвечает только за отображение и реакцию на пользовательские действия.

## Базовые классы 

### Component `<T>`
это абстрактный базовый класс для компонентов отображения пользовательского интерфейса , от которого можно наследоваться при создании конкретных компонентов отображения . Он служит основой для всех  компонентов в приложении, предоставляя общие методы для работы с DOM и шаблонный метод render.

### Api
Этот класс Api представляет собой универсальный базовый класс для работы с HTTP-запросами к API. Он упрощает выполнение GET, POST, PUT и DELETE запросов и автоматически обрабатывает ответы.
### EventEmitter  
Это класс для работы с событиями в приложении. Он позволяет подписываться на события, инициировать события и обрабатывать данные, передаваемые с этими событиями. Он реализует брокер событий, что позволяет компонентам приложения взаимодействовать друг с другом без тесной связи.
основные методы этого класса используемые в приложении:
**on`<T extends object>`(eventName: EventName, callback: (data: T) => void)**
Этот метод позволяет подписаться на событие с названием eventName. Когда событие произойдёт, переданный callback будет вызван с данными типа T.
**emit`<T extends object>`(eventName: string, data?: T)**
Используется для инициирования события. Когда мы инициируем событие, все подписчики на это событие получат переданные данные.

## Слой Model
### AppData
Это основной класс для хранения и управления данными приложения. Он реализует интерфейс IAppData и используется для работы с товарами, корзиной и оформлением заказа. Также он интегрирован с брокером событий (IEvents), чтобы уведомлять другие компоненты об изменениях.
#### свойства класса

- **products**
Хранит массив объектов IProduct, представляющих все товары.

- **cart**
Это объект ICart, представляющий текущую корзину пользователя. Содержит список товаров и итоговую сумму.
  
- **order — объект-сущность / структура данных для API**
Объект IOrder, представляющий текущий заказ пользователя. 
#### Методы класса

 - **setProducts(products)**
Устанавливает список доступных товаров.

- **addProductToCart(item)**
Добавляет товар в корзину и пересчитывает итоговую сумму.

- **removeProductFromCart(item)**
Удаляет товар из корзины

- **getCartTotal()**
Возвращает общую стоимость всех товаров в корзине.

- **getCartCounter()**
Возвращает количество товаров в корзине.

- **setOrderField(field, value)**
Устанавливает значение поля заказа (адрес или способ оплаты) и запускает валидацию формы заказа.

- **setContactField(field, value)**
Устанавливает контактные данные (email или телефон) и запускает валидацию формы контактов.

- **setOrderProductsList()**
Формирует список ID товаров из корзины для отправки на сервер.

- **validateForm(formName)**
Проверяет правильность заполнения форм заказа и контактов. При наличии ошибок отправляет события orderFormErrors:change или contactsFormErrors:change с описанием ошибок.

- **resetCart()**
Очищает корзину.

- **resetOrder()**
Сбрасывает все данные заказа.

- **resetSelectedProducts()**
Снимает выделение у всех выбранных товаров.

- **resetOrderAndCart()**
Полностью очищает корзину, заказ и снимает выделение товаров.

## Слой View
Слой **View** (представление) — это часть архитектуры приложения, которая отвечает за отображение данных пользователю и взаимодействие с ним.

- Класс **Page** представляет главную страницу приложения, где отображается каталог товаров и иконка корзины. Наследуется от класса Component.
*Основные функции:*

  - Отображает количество товаров в корзине (cartCounter)
  -  Отображает список карточек товаров в каталоге (productsCatalog)
  -  Реагирует на клик по корзине и вызывает событие cart:open
  -  Управляет блокировкой прокрутки страницы при открытии модальных окон (scrollLocked)

- Класс **Card** представляет карточку товара в каталоге. Наследуется от базового класса Component и управляет отображением информации о товаре: названия, изображения, категории и цены. Также может реагировать на клики.
*Основные функции:*
  - Показывать данные товара в карточке
  - Настраивать визуальное отображение категории
  - Обрабатывать клики по карточке
  
- Класс **CardPreview** расширяет Card и используется для отображения карточки товара в модальном окне (предпросмотр).
*Дополнительные функции:*
  - Показывать подробное описание товара
  -  Управлять кнопкой добавления в корзину

- Класс **Cart** отвечает за отображение окна корзины. Наследуется от Component и управляет заголовком, списком товаров, общей стоимостью и кнопкой оформления заказа.
*Основные функции:*

  -  Отображать список товаров в корзине
  -  Показывать общую сумму
   - Активировать кнопку «Оформить», если корзина не пуста
  -  Генерировать событие order:started при нажатии на кнопку
 
- Класс **CartProduct** представляет карточку одного товара внутри корзины. Отображает порядковый номер, название, цену товара и содержит кнопку удаления.
*Основные функции:*

  -  Отображать информацию о товаре, добавленном в корзину
  -  Удалять карточку при клике на кнопку
  -  Генерировать пользовательское действие при удалении товара

- Класс **OrderForm** отвечает за отображение и управление первой частью формы заказа — выбором способа оплаты и вводом адреса доставки.
Наследуется от класса  Form<Pick<IOrderForm, 'payment' | 'address'>>
*Основные функции:*
  -  Позволяет выбрать способ оплаты: онлайн или при получении
  -  Показывает и обновляет поле адреса
  -  Управляет стилями кнопок в зависимости от выбора
  -  Содержит метод resetPaymentButtons() — для сброса выделения способа оплаты
  
- Класс **ContactsForm** управляет второй частью формы заказа — контактными данными покупателя. Наследуется от класса Form<Pick<IOrderForm, 'email' | 'phone'>>
*Основные функции:*
  - Отображает поля для ввода email и телефона
  -  Позволяет установить значения этих полей
  -  Использует общую логику ввода и отправки от класса Form
  
- Класс **Success** отвечает за отображение в модальном окне информации о успешном заказе. Наследуется от класса  Component.
*Основные функции:*
  -  Отображает общую сумму заказа (total)
  -  Обрабатывает клик по кнопке закрытия, чтобы отправить событие success:close
  -  Позволяет пользователю закрыть окно удачного заказа
- Класс **Modal** представляет модальное окно, которое используется для отображения различных типов информации в интерфейсе. Наследуется от класса Component
*Основные функции:*

  -  Отображает и скрывает модальное окно.
  -  Обрабатывает клики на кнопке закрытия и на самой области окна для закрытия модала.
  -  Управляет содержимым модального окна через свойство content.
  -  Управляет отображением активного состояния модального окна с помощью класса modal_active.
  -  Использует события modal:open и modal:close для взаимодействия с другими частями приложения.

    *Методы:*
  -  **open**: открывает модальное окно.
  -  **close**: закрывает модальное окно.
  -  **render**: рендерит модальное окно с новым содержимым  и сразу открывает его.

- Класс **Form** представляет собой основу для создания форм в приложении. Он предоставляет функционал для обработки ввода, валидации, отправки данных и отображения ошибок. Наследуется от класса  Component.
*Основные функции:*
  -  Управляет состоянием формы (валидность, ошибки).
  -  Отслеживает изменения в полях формы и вызывает события при изменении значений.
  -  Обрабатывает отправку формы и блокирует кнопку отправки в зависимости от состояния валидности.
  -  Отображает ошибки валидации при наличии.

    *Ключевые методы:*

  -  **onInputChange**: Обрабатывает изменения в полях формы, эмитируя события для каждого поля.
  -  **valid**: Устанавливает состояние кнопки отправки формы (если форма невалидна, кнопка будет заблокирована).
  -  **errors**: Отображает ошибки валидации, если они есть.

## Presenter

В нашем приложении роль презентера выполняет брокер событий `EventEmitter`. Брокер событий управляет взаимодействием между компонентами представления (Views) и моделью (Model), передавая события между ними и обеспечивая логику обновления данных, реагируя на действия пользователя. Все события, связанные с действиями пользователя (например, добавление товара в корзину, отправка формы, открытие модальных окон), передаются через брокер. Он слушает события от компонентов представления, обновляет модель и уведомляет компоненты представления о необходимых изменениях, например, обновлении UI или изменении состояния данных.

### Список событий
- **products:changed** - Обновляет отображение каталога товаров на странице, перерисовывая карточки товаров, когда их данные изменяются. В нашем случае при получении нового списка продуктов с сервера.
- **card:open** - Открывает карточку товара в модальном окне для просмотра подробной информации о продукте.
- **card:addToCart** -  Добавляет выбранный товар в корзину.
- **cart:open** - Открывает модальное окно корзины с товарами, которые были добавлены в корзину.
- **card:removeFromCart** - Удаляет товар из корзины.
- **modal:open** - Блокирует прокрутку страницы, когда открывается модальное окно.
- **modal:close** - Разблокирует прокрутку страницы, когда закрывается модальное окно.
- **order:started** - Инициализирует отображение формы заказа, если пользователь начинает оформление заказа.
- **orderFormErrors:change** - Обновляет состояние валидации формы заказа и выводит ошибки при неправильном вводе.
- **contactsFormErrors:change** - Обновляет состояние валидации формы контактов и выводит ошибки при неправильном вводе.
- **order:submit** - Обрабатывает отправку формы заказа, переходя к следующему этапу (ввод контактных данных).
- **contacts:submit** - Отправляет заказ на сервер, если пользователь заполнил контактные данные и подтверждает заказ.
- **order:success** - Отображает окно с успешным завершением заказа, показывая итоговую сумму.
- **success:close** - Закрывает окно с подтверждением успешного оформления заказа.

